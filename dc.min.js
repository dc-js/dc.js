/*
 *  Copyright 2012 the original author or authors.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  You may obtain a copy of the License at
 *
 *        http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */function printSingleValue(e){var t=""+e;return e instanceof Date?t=dc.dateFormat(e):typeof e=="string"?t=e:typeof e=="number"&&(t=Math.round(e)),t}dc={version:"0.9.1",constants:{CHART_CLASS:"dc-chart",DEBUG_GROUP_CLASS:"debug",STACK_CLASS:"stack",DESELECTED_CLASS:"deselected",SELECTED_CLASS:"selected",NODE_INDEX_NAME:"__index__",GROUP_INDEX_NAME:"__group_index__",DEFAULT_CHART_GROUP:"__default_chart_group__",EVENT_DELAY:40},_renderlet:null},dc.chartRegistry=function(){function t(t){return t||(t=dc.constants.DEFAULT_CHART_GROUP),e[t]||(e[t]=[]),t}var e={};return this.has=function(t){for(var n in e)if(e[n].indexOf(t)>=0)return!0;return!1},this.register=function(n,r){r=t(r),e[r].push(n)},this.clear=function(){e={}},this.list=function(n){return n=t(n),e[n]},this}(),dc.registerChart=function(e,t){dc.chartRegistry.register(e,t)},dc.hasChart=function(e){return dc.chartRegistry.has(e)},dc.deregisterAllCharts=function(){dc.chartRegistry.clear()},dc.filterAll=function(e){var t=dc.chartRegistry.list(e);for(var n=0;n<t.length;++n)t[n].filterAll()},dc.renderAll=function(e){var t=dc.chartRegistry.list(e);for(var n=0;n<t.length;++n)t[n].render();dc._renderlet!==null&&dc._renderlet(e)},dc.redrawAll=function(e){var t=dc.chartRegistry.list(e);for(var n=0;n<t.length;++n)t[n].redraw();dc._renderlet!==null&&dc._renderlet(e)},dc.transition=function(e,t,n){if(t<=0||t===undefined)return e;var r=e.transition().duration(t);return n instanceof Function&&n(r),r},dc.units={},dc.units.integers=function(e,t){return new Array(Math.abs(t-e))},dc.round={},dc.round.floor=function(e){return Math.floor(e)},dc.round.ceil=function(e){return Math.ceil(e)},dc.round.round=function(e){return Math.round(e)},dc.override=function(obj,functionName,newFunction){var existingFunction=obj[functionName];obj[functionName]=function(){var expression="newFunction(";for(var i=0;i<arguments.length;++i)expression+="argument["+i+"],";return expression+="existingFunction);",eval(expression)}},dc.renderlet=function(e){return arguments.length?(dc._renderlet=e,dc):dc._renderlet},dc.instanceOfChart=function(e){return e instanceof Object&&e.__dc_flag__},dc.errors={},dc.errors.Exception=function(e){var t=e!=null?e:"Unexpected internal error";this.message=t,this.toString=function(){return t}},dc.errors.InvalidStateException=function(){dc.errors.Exception.apply(this,arguments)},dc.dateFormat=d3.time.format("%m/%d/%Y"),dc.printers={},dc.printers.filter=function(e){var t="";return e&&(e instanceof Array?e.length>=2?t="["+printSingleValue(e[0])+" -> "+printSingleValue(e[1])+"]":e.length>=1&&(t=printSingleValue(e[0])):t=printSingleValue(e)),t},dc.utils={},dc.utils.add=function(e,t){if(e instanceof Date){var n=new Date;return n.setTime(e.getTime()),n.setDate(e.getDate()+t),n}return e+t},dc.utils.subtract=function(e,t){if(e instanceof Date){var n=new Date;return n.setTime(e.getTime()),n.setDate(e.getDate()-t),n}return e-t},dc.utils.GroupStack=function(){function r(t){e[t]||(e[t]=[])}var e=[],t=[],n;this.setDataPoint=function(t,n,i){r(t),e[t][n]=i},this.getDataPoint=function(t,n){r(t);var i=e[t][n];return i==undefined&&(i=0),i},this.addGroup=function(e,r){return r||(r=n),t.push([e,r]),t.length-1},this.getGroupByIndex=function(e){return t[e][0]},this.getAccessorByIndex=function(e){return t[e][1]},this.size=function(){return t.length},this.clear=function(){e=[],t=[]},this.setDefaultAccessor=function(e){n=e}},dc.utils.groupMax=function(e,t){return d3.max(e.all(),function(e){return t(e)})},dc.utils.groupMin=function(e,t){return d3.min(e.all(),function(e){return t(e)})},dc.utils.nameToId=function(e){return e.toLowerCase().replace(/[\s]/g,"_").replace(/[\.']/g,"")},dc.events={current:null},dc.events.trigger=function(e,t){if(!t){e();return}dc.events.current=e,setTimeout(function(){e==dc.events.current&&e()},t)},dc.cumulative={},dc.cumulative.Base=function(){this._keyIndex=[],this._map={},this.sanitizeKey=function(e){return e+="",e},this.clear=function(){this._keyIndex=[],this._map={}},this.size=function(){return this._keyIndex.length},this.getValueByKey=function(e){e=this.sanitizeKey(e);var t=this._map[e];return t},this.setValueByKey=function(e,t){return e=this.sanitizeKey(e),this._map[e]=t},this.indexOfKey=function(e){return e=this.sanitizeKey(e),this._keyIndex.indexOf(e)},this.addToIndex=function(e){e=this.sanitizeKey(e),this._keyIndex.push(e)},this.getKeyByIndex=function(e){return this._keyIndex[e]}},dc.cumulative.Sum=function(){dc.cumulative.Base.apply(this,arguments),this.add=function(e,t){t==null&&(t=0),this.getValueByKey(e)==null?(this.addToIndex(e),this.setValueByKey(e,t)):this.setValueByKey(e,this.getValueByKey(e)+t)},this.minus=function(e,t){this.setValueByKey(e,this.getValueByKey(e)-t)},this.cumulativeSum=function(e){var t=this.indexOfKey(e);if(t<0)return 0;var n=0;for(var r=0;r<=t;++r){var i=this.getKeyByIndex(r);n+=this.getValueByKey(i)}return n}},dc.cumulative.Sum.prototype=new dc.cumulative.Base,dc.cumulative.CountUnique=function(){function e(e){var t=0,n;for(n in e)e.hasOwnProperty(n)&&t++;return t}dc.cumulative.Base.apply(this,arguments),this.add=function(e,t){this.getValueByKey(e)==null&&(this.setValueByKey(e,{}),this.addToIndex(e)),t!=null&&(this.getValueByKey(e)[t]==null&&(this.getValueByKey(e)[t]=0),this.getValueByKey(e)[t]+=1)},this.minus=function(e,t){this.getValueByKey(e)[t]-=1,this.getValueByKey(e)[t]<=0&&delete this.getValueByKey(e)[t]},this.count=function(t){return e(this.getValueByKey(t))},this.cumulativeCount=function(e){var t=this.indexOfKey(e);if(t<0)return 0;var n=0;for(var r=0;r<=t;++r){var i=this.getKeyByIndex(r);n+=this.count(i)}return n}},dc.cumulative.CountUnique.prototype=new dc.cumulative.Base,dc.baseChart=function(e){e.__dc_flag__=!0;var t,n,r,i,s,o=200,u=200,a=function(e){return e.key},f=function(e){return e.value},l=function(e){return e.key},c=!1,h=function(e){return e.key+": "+e.value},p=!1,d=750,v=dc.printers.filter,m=[],g=dc.constants.DEFAULT_CHART_GROUP;return e.dimension=function(n){return arguments.length?(t=n,e):t},e.group=function(t){return arguments.length?(n=t,e):n},e.orderedGroup=function(){return n.order(function(e){return e.key})},e.filterAll=function(){return e.filter(null)},e.dataAreSet=function(){return t!=undefined&&n!=undefined},e.select=function(e){return i.select(e)},e.selectAll=function(e){return i.selectAll(e)},e.anchor=function(t,n){return arguments.length?(dc.instanceOfChart(t)?(r=t.anchor(),i=t.root()):(r=t,i=d3.select(r),i.classed(dc.constants.CHART_CLASS,!0),dc.registerChart(e,n)),g=n,e):r},e.root=function(t){return arguments.length?(i=t,e):i},e.width=function(t){return arguments.length?(o=t,e):o},e.height=function(t){return arguments.length?(u=t,e):u},e.svg=function(t){return arguments.length?(s=t,e):s},e.resetSvg=function(){return e.select("svg").remove(),e.generateSvg()},e.generateSvg=function(){return s=e.root().append("svg").attr("width",e.width()).attr("height",e.height()),s},e.filterPrinter=function(t){return arguments.length?(v=t,e):v},e.turnOnControls=function(){e.selectAll(".reset").style("display",null),e.selectAll(".filter").text(v(e.filter())).style("display",null)},e.turnOffControls=function(){e.selectAll(".reset").style("display","none"),e.selectAll(".filter").style("display","none").text(e.filter())},e.transitionDuration=function(t){return arguments.length?(d=t,e):d},e.render=function(){if(t==null)throw new dc.errors.InvalidStateException("Mandatory attribute chart.dimension is missing on chart["+e.anchor()+"]");if(n==null)throw new dc.errors.InvalidStateException("Mandatory attribute chart.group is missing on chart["+e.anchor()+"]");var r=e.doRender();return e.invokeRenderlet(e),r},e.redraw=function(){var t=e.doRedraw();return e.invokeRenderlet(e),t},e.filter=function(t){return e},e.doRender=function(){return e},e.doRedraw=function(){return e},e.keyAccessor=function(t){return arguments.length?(a=t,e):a},e.valueAccessor=function(t){return arguments.length?(f=t,e):f},e.label=function(t){return arguments.length?(l=t,c=!0,e):l},e.renderLabel=function(t){return arguments.length?(c=t,e):c},e.title=function(t){return arguments.length?(h=t,p=!0,e):h},e.renderTitle=function(t){return arguments.length?(p=t,e):p},e.renderlet=function(t){return m.push(t),e},e.invokeRenderlet=function(e){for(var t=0;t<m.length;++t)m[t](e)},e.chartGroup=function(t){return arguments.length?(g=t,e):g},e},dc.coordinateGridChart=function(e){function S(t){e.elasticX()&&u.domain([e.xAxisMin(),e.xAxisMax()]),u.range([0,e.xAxisLength()]),a=a.scale(e.x()).orient("bottom"),x(t)}function x(t){if(E){var r=t.selectAll("g."+i);r.empty()&&(r=t.insert("g",":first-child").attr("class",n+" "+i).attr("transform","translate("+e.yAxisX()+","+e.margins().top+")"));var s=a.tickValues()?a.tickValues():u.ticks(a.ticks()[0]),o=r.selectAll("line").data(s),f=o.enter().append("line").attr("x1",function(e){return u(e)}).attr("y1",e.xAxisY()-e.margins().top).attr("x2",function(e){return u(e)}).attr("y2",0).attr("opacity",0);dc.transition(f,e.transitionDuration()).attr("opacity",1),dc.transition(o,e.transitionDuration()).attr("x1",function(e){return u(e)}).attr("y1",e.xAxisY()-e.margins().top).attr("x2",function(e){return u(e)}).attr("y2",0),o.exit().remove()}}function T(n){if(h==null||e.elasticY())h=d3.scale.linear(),h.domain([e.yAxisMin(),e.yAxisMax()]).rangeRound([e.yAxisHeight(),0]);h.range([e.yAxisHeight(),0]),p=p.scale(h).orient("left").ticks(t),N(n)}function N(t){if(w){var i=t.selectAll("g."+r),s=p.tickValues()?p.tickValues():h.ticks(p.ticks()[0]);i.empty()&&(i=t.insert("g",":first-child").attr("class",n+" "+r).attr("transform","translate("+e.yAxisX()+","+e.margins().top+")"));var o=i.selectAll("line").data(s),u=o.enter().append("line").attr("x1",1).attr("y1",function(e){return h(e)}).attr("x2",e.xAxisLength()).attr("y2",function(e){return h(e)}).attr("opacity",0);dc.transition(u,e.transitionDuration()).attr("opacity",1),dc.transition(o,e.transitionDuration()).attr("x1",1).attr("y1",function(e){return h(e)}).attr("x2",e.xAxisLength()).attr("y2",function(e){return h(e)}),o.exit().remove()}}function C(){return e.xAxisY()-e.margins().top}function k(e){}function L(t){var n=g.extent();e.round()&&(n[0]=n.map(e.round())[0],n[1]=n.map(e.round())[1],o.select(".brush").call(g.extent(n))),n=g.extent(),e.redrawBrush(o),g.empty()?dc.events.trigger(function(){e.filter(null),dc.redrawAll(e.chartGroup())}):dc.events.trigger(function(){e.filter([n[0],n[1]]),dc.redrawAll(e.chartGroup())},dc.constants.EVENT_DELAY)}function A(e){}var t=5,n="grid-line",r="horizontal",i="vertical";e=dc.baseChart(e);var s={top:10,right:50,bottom:30,left:30},o,u,a=d3.svg.axis(),f=dc.units.integers,l=0,c=!1,h,p=d3.svg.axis(),d=0,v=!1,m,g=d3.svg.brush(),y=!0,b,w=!1,E=!1;return e.generateG=function(t){return t==null&&(t=e.svg()),o=t.append("g"),o},e.g=function(t){return arguments.length?(o=t,e):o},e.margins=function(t){return arguments.length?(s=t,e):s},e.x=function(t){return arguments.length?(u=t,e):u},e.xAxis=function(t){return arguments.length?(a=t,e):a},e.renderXAxis=function(t){var n=t.selectAll("g.x");n.empty()&&(n=t.append("g").attr("class","axis x").attr("transform","translate("+e.margins().left+","+e.xAxisY()+")")),dc.transition(n,e.transitionDuration()).call(a)},e.xAxisY=function(){return e.height()-e.margins().bottom},e.xAxisLength=function(){return e.width()-e.margins().left-e.margins().right},e.xUnits=function(t){return arguments.length?(f=t,e):f},e.renderYAxis=function(t){var n=t.selectAll("g.y");n.empty()&&(n=t.append("g").attr("class","axis y").attr("transform","translate("+e.yAxisX()+","+e.margins().top+")")),dc.transition(n,e.transitionDuration()).call(p)},e.renderHorizontalGridLines=function(t){return arguments.length?(w=t,e):w},e.renderVerticalGridLines=function(t){return arguments.length?(E=t,e):E},e.yAxisX=function(){return e.margins().left},e.y=function(t){return arguments.length?(h=t,e):h},e.yAxis=function(t){return arguments.length?(p=t,e):p},e.elasticY=function(t){return arguments.length?(v=t,e):v},e.elasticX=function(t){return arguments.length?(c=t,e):c},e.xAxisMin=function(){var t=d3.min(e.group().all(),function(t){return e.keyAccessor()(t)});return dc.utils.subtract(t,l)},e.xAxisMax=function(){var t=d3.max(e.group().all(),function(t){return e.keyAccessor()(t)});return dc.utils.add(t,l)},e.yAxisMin=function(){var t=d3.min(e.group().all(),function(t){return e.valueAccessor()(t)})-d;return t},e.yAxisMax=function(){var t=d3.max(e.group().all(),function(t){return e.valueAccessor()(t)});return dc.utils.add(t,d)},e.xAxisPadding=function(t){return arguments.length?(l=t,e):l},e.yAxisPadding=function(t){return arguments.length?(d=t,e):d},e.yAxisHeight=function(){return e.height()-e.margins().top-e.margins().bottom},e.round=function(t){return arguments.length?(b=t,e):b},e.filter=function(t){return arguments.length?(t?(m=t,e.brush().extent(t),e.dimension().filterRange(t),e.turnOnControls()):(m=null,e.brush().clear(),e.dimension().filterAll(),e.turnOffControls()),e):m},e.brush=function(t){return arguments.length?(g=t,e):g},e.renderBrush=function(t){if(y){g.on("brushstart",k).on("brush",L).on("brushend",A);var n=t.append("g").attr("class","brush").attr("transform","translate("+e.margins().left+","+e.margins().top+")").call(g.x(e.x()));n.selectAll("rect").attr("height",C()),n.selectAll(".resize").append("path").attr("d",e.resizeHandlePath),m&&e.redrawBrush(t)}},e.redrawBrush=function(t){if(y){e.filter()&&e.brush().empty()&&e.brush().extent(e.filter());var n=t.select("g.brush");n.call(e.brush().x(e.x())),n.selectAll("rect").attr("height",C()),e.fadeDeselectedArea()}},e.fadeDeselectedArea=function(){},e.resizeHandlePath=function(e){var t=+(e=="e"),n=t?1:-1,r=C()/3;return"M"+.5*n+","+r+"A6,6 0 0 "+t+" "+6.5*n+","+(r+6)+"V"+(2*r-6)+"A6,6 0 0 "+t+" "+.5*n+","+2*r+"Z"+"M"+2.5*n+","+(r+8)+"V"+(2*r-8)+"M"+4.5*n+","+(r+8)+"V"+(2*r-8)},e.doRender=function(){if(u==null)throw new dc.errors.InvalidStateException("Mandatory attribute chart.x is missing on chart["+e.anchor()+"]");return e.resetSvg(),e.dataAreSet()&&(e.generateG(),S(e.g()),T(e.g()),e.plotData(),e.renderXAxis(e.g()),e.renderYAxis(e.g()),e.renderBrush(e.g())),e},e.doRedraw=function(){return S(e.g()),T(e.g()),e.plotData(),e.elasticY()&&e.renderYAxis(e.g()),e.elasticX()&&e.renderXAxis(e.g()),e.redrawBrush(e.g()),e},e.subRender=function(){return e.dataAreSet()&&e.plotData(),e},e.brushOn=function(t){return arguments.length?(y=t,e):y},e},dc.colorChart=function(e){var t=d3.scale.category20c(),n=[0,t.range().length],r=function(r){var i=n[0],s=n[1];isNaN(r)&&(r=0);if(s==null)return t(r);var o=e.colors().range().length,u=(s-i)/o,a=Math.abs(Math.min(o-1,Math.round((r-i)/u)));return e.colors()(a)},i=function(e,t){return t};return e.colors=function(r){if(!arguments.length)return t;if(r instanceof Array){t=d3.scale.ordinal().range(r);var i=[];for(var s=0;s<r.length;++s)i.push(s);t.domain(i)}else t=r;return n=[0,t.range().length],e},e.colorCalculator=function(t){return arguments.length?(r=t,e):r},e.getColor=function(e,t){return r(i(e,t))},e.colorAccessor=function(t){return arguments.length?(i=t,e):i},e.colorDomain=function(t){return arguments.length?(n=t,e):n},e},dc.singleSelectionChart=function(e){var t;return e.hasFilter=function(){return t!=null},e.filter=function(n){return arguments.length?(t=n,e.dataAreSet()&&e.dimension().filter(t),n?e.turnOnControls():e.turnOffControls(),e):t},e.highlightSelected=function(e){d3.select(e).classed(dc.constants.SELECTED_CLASS,!0),d3.select(e).classed(dc.constants.DESELECTED_CLASS,!1)},e.fadeDeselected=function(e){d3.select(e).classed(dc.constants.SELECTED_CLASS,!1),d3.select(e).classed(dc.constants.DESELECTED_CLASS,!0)},e.resetHighlight=function(e){d3.select(e).classed(dc.constants.SELECTED_CLASS,!1),d3.select(e).classed(dc.constants.DESELECTED_CLASS,!1)},e},dc.stackableChart=function(e){function o(){r=null,i=null,s=null}var t=0,n=new dc.utils.GroupStack,r,i,s;return e.stack=function(t,r){return n.setDefaultAccessor(e.valueAccessor()),n.addGroup(t,r),o(),e},e.allGroups=function(){if(r==null){r=[],r.push(e.group());for(var t=0;t<n.size();++t)r.push(n.getGroupByIndex(t))}return r},e.allValueAccessors=function(){if(i==null){i=[],i.push(e.valueAccessor());for(var t=0;t<n.size();++t)i.push(n.getAccessorByIndex(t))}return i},e.getValueAccessorByIndex=function(t){return e.allValueAccessors()[t]},e.yAxisMin=function(){var t=0,n=e.allGroups();for(var r=0;r<n.length;++r){var i=n[r],s=d3.min(i.all(),function(t){return e.getValueAccessorByIndex(r)(t)});s<t&&(t=s)}return t},e.yAxisMax=function(){var t=0,n=e.allGroups();for(var r=0;r<n.length;++r){var i=n[r];t+=dc.utils.groupMax(i,e.getValueAccessorByIndex(r))}return dc.utils.add(t,e.yAxisPadding())},e.allKeyAccessors=function(){if(s==null){s=[],s.push(e.keyAccessor());for(var t=0;t<n.size();++t)s.push(e.keyAccessor())}return s},e.getKeyAccessorByIndex=function(t){return e.allKeyAccessors()[t]},e.xAxisMin=function(){var t=null,n=e.allGroups();for(var r=0;r<n.length;++r){var i=n[r],s=dc.utils.groupMin(i,e.getKeyAccessorByIndex(r));if(t==null||t>s)t=s}return dc.utils.subtract(t,e.xAxisPadding())},e.xAxisMax=function(){var t=null,n=e.allGroups();for(var r=0;r<n.length;++r){var i=n[r],s=dc.utils.groupMax(i,e.getKeyAccessorByIndex(r));if(t==null||t<s)t=s}return dc.utils.add(t,e.xAxisPadding())},e.dataPointBaseline=function(){return e.margins().top+e.yAxisHeight()},e.dataPointHeight=function(n,r){var i=e.yAxisHeight()-e.y()(e.getValueAccessorByIndex(r)(n));if(isNaN(i)||i<t)i=t;return i},e.calculateDataPointMatrix=function(t){for(var r=0;r<t.length;++r){var i=t[r].all();for(var s=0;s<i.length;++s){var o=i[s];r==0?n.setDataPoint(r,s,e.dataPointBaseline()-e.dataPointHeight(o,r)):n.setDataPoint(r,s,n.getDataPoint(r-1,s)-e.dataPointHeight(o,r))}}},e.getChartStack=function(){return n},e},dc.abstractBubbleChart=function(e){var t=.3,n=10;e.BUBBLE_NODE_CLASS="node",e.BUBBLE_CLASS="bubble",e.MIN_RADIUS=10,e=dc.singleSelectionChart(dc.colorChart(e)),e.renderLabel(!0),e.renderTitle(!1);var r=d3.scale.linear().domain([0,100]),i=function(e){return e.r};e.r=function(t){return arguments.length?(r=t,e):r},e.radiusValueAccessor=function(t){return arguments.length?(i=t,e):i},e.rMin=function(){var t=d3.min(e.group().all(),function(t){return e.radiusValueAccessor()(t)});return t},e.rMax=function(){var t=d3.max(e.group().all(),function(t){return e.radiusValueAccessor()(t)});return t},e.bubbleR=function(t){var n=e.radiusValueAccessor()(t),r=e.r()(n);if(isNaN(r)||n<=0)r=0;return r};var s=function(t){return e.label()(t)},o=function(t){return e.bubbleR(t)>n?1:0};e.doRenderLabel=function(t){if(e.renderLabel()){var n=t.select("text");n.empty()&&(n=t.append("text").attr("text-anchor","middle").attr("dy",".3em").on("click",e.onClick)),n.attr("opacity",0).text(s),dc.transition(n,e.transitionDuration()).attr("opacity",o)}},e.doUpdateLabels=function(t){if(e.renderLabel()){var n=t.selectAll("text").text(s);dc.transition(n,e.transitionDuration()).attr("opacity",o)}};var u=function(t){return e.title()(t)};return e.doRenderTitles=function(t){if(e.renderTitle()){var n=t.select("title");n.empty()&&t.append("title").text(u)}},e.doUpdateTitles=function(t){e.renderTitle()&&t.selectAll("title").text(u)},e.onClick=function(t){var n=t.key;n==e.filter()?dc.events.trigger(function(){e.filter(null),dc.redrawAll(e.chartGroup())}):dc.events.trigger(function(){e.filter(n),dc.redrawAll(e.chartGroup())})},e.minRadiusWithLabel=function(t){return arguments.length?(n=t,e):n},e.maxBubbleRelativeSize=function(n){return arguments.length?(t=n,e):t},e.initBubbleColor=function(t,n){return this[dc.constants.NODE_INDEX_NAME]=n,e.getColor(t,n)},e.updateBubbleColor=function(t,n){return e.getColor(t,this[dc.constants.NODE_INDEX_NAME])},e.fadeDeselectedArea=function(){e.hasFilter()?e.selectAll("g."+e.BUBBLE_NODE_CLASS).each(function(t){e.isSelectedNode(t)?e.highlightSelected(this):e.fadeDeselected(this)}):e.selectAll("g."+e.BUBBLE_NODE_CLASS).each(function(t){e.resetHighlight(this)})},e.isSelectedNode=function(t){return e.filter()==t.key},e},dc.pieChart=function(e,t){function f(){if(a.dataAreSet()){var e=E(),t=a.buildArcs(),n=e(a.orderedGroup().top(Infinity)),i=o.selectAll("g."+r).data(n);l(i,t,n),v(n,t),b(i),w()}}function l(e,t,n){var r=c(e);h(r,t),p(r),d(n,t)}function c(e){var t=e.enter().append("g").attr("class",function(e,t){return r+" "+t});return t}function h(e,t){var n=e.append("path").attr("fill",function(e,t){return a.getColor(e,t)}).on("click",C).attr("d",t);n.transition().duration(a.transitionDuration()).attrTween("d",T)}function p(e){a.renderTitle()&&e.append("title").text(function(e){return a.title()(e)})}function d(e,t){if(a.renderLabel()){var n=o.selectAll("text."+r).data(e),s=n.enter().append("text").attr("class",function(e,t){return r+" "+t}).on("click",C);dc.transition(s,a.transitionDuration()).attr("transform",function(e){e.innerRadius=a.innerRadius(),e.outerRadius=i;var n=t.centroid(e);return isNaN(n[0])||isNaN(n[1])?"translate(0,0)":"translate("+n+")"}).attr("text-anchor","middle").text(function(e){var t=e.data;return x(t)||S(e)?"":a.label()(e)})}}function v(e,t){m(e,t),g(e,t),y(e)}function m(e,t){var n=o.selectAll("g."+r).data(e).select("path").attr("d",t);dc.transition(n,a.transitionDuration(),function(e){e.attrTween("d",T)}).attr("fill",function(e,t){return a.getColor(e,t)})}function g(e,t){if(a.renderLabel()){var n=o.selectAll("text."+r).data(e);dc.transition(n,a.transitionDuration()).attr("transform",function(e){e.innerRadius=a.innerRadius(),e.outerRadius=i;var n=t.centroid(e);return isNaN(n[0])||isNaN(n[1])?"translate(0,0)":"translate("+n+")"}).attr("text-anchor","middle").text(function(e){var t=e.data;return x(t)||S(e)?"":a.label()(e)})}}function y(e){a.renderTitle()&&o.selectAll("g."+r).data(e).select("title").text(function(e){return a.title()(e)})}function b(e){e.exit().remove()}function w(){a.hasFilter()?a.selectAll("g."+r).each(function(e){a.isSelectedSlice(e)?a.highlightSelected(this):a.fadeDeselected(this)}):a.selectAll("g."+r).each(function(e){a.resetHighlight(this)})}function E(){return d3.layout.pie().sort(null).value(function(e){return a.valueAccessor()(e)})}function S(e){var t=e.endAngle-e.startAngle;return isNaN(t)||t<u}function x(e){return a.valueAccessor()(e)==0}function T(e){e.innerRadius=a.innerRadius();var t=this._current;N(t)&&(t={startAngle:0,endAngle:0});var n=d3.interpolate(t,e);return this._current=n(0),function(e){return a.buildArcs()(n(e))}}function N(e){return e==null||isNaN(e.startAngle)||isNaN(e.endAngle)}function C(e){var t=a.keyAccessor()(e.data);t==a.filter()?dc.events.trigger(function(){a.filter(null),dc.redrawAll(a.chartGroup())}):dc.events.trigger(function(){a.filter(t),dc.redrawAll(a.chartGroup())})}var n=.5,r="pie-slice",i=0,s=0,o,u=n,a=dc.singleSelectionChart(dc.colorChart(dc.baseChart({})));return a.label(function(e){return a.keyAccessor()(e.data)}),a.renderLabel(!0),a.title(function(e){return a.keyAccessor()(e.data)+": "+a.valueAccessor()(e.data)}),a.transitionDuration(350),a.doRender=function(){return a.resetSvg(),o=a.svg().append("g").attr("transform","translate("+a.cx()+","+a.cy()+")"),f(),a},a.innerRadius=function(e){return arguments.length?(s=e,a):s},a.radius=function(e){return arguments.length?(i=e,a):i},a.cx=function(){return a.width()/2},a.cy=function(){return a.height()/2},a.buildArcs=function(){return d3.svg.arc().outerRadius(i).innerRadius(s)},a.isSelectedSlice=function(e){return a.filter()==a.keyAccessor()(e.data)},a.doRedraw=function(){return f(),a},a.minAngelForLabel=function(e){return arguments.length?(u=e,a):u},a.anchor(e,t)},dc.barChart=function(e,t){function a(e,t){var n=i.g().selectAll("rect."+dc.constants.STACK_CLASS+e).data(t.all());f(n,e),l(n,e),c(n)}function f(e,t){var e=e.enter().append("rect");e.attr("class","bar "+dc.constants.STACK_CLASS+t).attr("x",function(e,n){return v(this,e,t,n)}).attr("y",i.xAxisY()).attr("width",p),i.renderTitle()&&e.append("title").text(i.title()),dc.transition(e,i.transitionDuration()).attr("y",function(e,t){return g(this,e,t)}).attr("height",function(e){return i.dataPointHeight(e,m(this))})}function l(e,t){i.renderTitle()&&e.select("title").text(i.title()),dc.transition(e,i.transitionDuration()).attr("x",function(e,n){return v(this,e,t,n)}).attr("y",function(e,t){return g(this,e,t)}).attr("height",function(e){return i.dataPointHeight(e,m(this))})}function c(e){dc.transition(e.exit(),i.transitionDuration()).attr("y",i.xAxisY()).attr("height",0)}function h(){return s==null&&(s=i.xUnits()(i.x().domain()[0],i.x().domain()[1]).length),s}function p(e){var t=h(),r=Math.floor(i.xAxisLength()/t);r-=o;if(isNaN(r)||r<n)r=n;return r}function d(e,t){e[dc.constants.GROUP_INDEX_NAME]=t}function v(e,t,n,r){d(e,n);var s=i.x()(i.keyAccessor()(t))+i.margins().left;return u&&(s-=p(t)/2),s}function m(e){var t=e[dc.constants.GROUP_INDEX_NAME];return t}function g(e,t,n){var r=m(e);return i.getChartStack().getDataPoint(r,n)}var n=1,r=2,i=dc.stackableChart(dc.coordinateGridChart({})),s,o=r,u=!1;return i.plotData=function(){var e=i.allGroups();i.calculateDataPointMatrix(e);for(var t=0;t<e.length;++t)a(t,e[t])},i.fadeDeselectedArea=function(){var e=i.g().selectAll("rect.bar");if(!i.brush().empty()&&i.brush().extent()!=null){var t=i.brush().extent()[0],n=i.brush().extent()[1];e.classed(dc.constants.DESELECTED_CLASS,function(e){var r=i.keyAccessor()(e);return r<t||r>=n})}else e.classed(dc.constants.DESELECTED_CLASS,!1)},i.centerBar=function(e){return arguments.length?(u=e,i):u},i.gap=function(e){return arguments.length?(o=e,i):o},i.anchor(e,t)},dc.lineChart=function(e,t){function c(e,t){var n=h(e),r=p(n,t),i=d(r,n,e);f&&g(r,n,e,i),a.renderTitle()&&y(r,e)}function h(e){return dc.constants.STACK_CLASS+e}function p(e,t){var n=a.g().select("g."+e);return n.empty()&&(n=a.g().append("g").attr("class",e)),n.datum(t.all()),n}function d(e,t,n){var r=e.select("path.line");r.empty()&&(r=e.append("path").attr("class","line "+t)),r[0][0][dc.constants.GROUP_INDEX_NAME]=n;var i=d3.svg.line().x(v).y(function(e,t){var n=this[dc.constants.GROUP_INDEX_NAME];return m(e,t,n)});return dc.transition(r,a.transitionDuration(),function(e){e.ease("linear")}).attr("d",i),i}function g(e,t,r,i){var s=e.selectAll("path.area");s.empty()&&(s=e.append("path").attr("class","area "+t)),s[0][0][dc.constants.GROUP_INDEX_NAME]=r;var o=d3.svg.area().x(i.x()).y1(i.y()).y0(function(e,t){var r=this[dc.constants.GROUP_INDEX_NAME];return r==0?a.y()(0)-n+a.margins().top:a.getChartStack().getDataPoint(--r,t)-n});dc.transition(s,a.transitionDuration(),function(e){e.ease("linear")}).attr("d",o)}function y(e,t){var n=e.select("g."+i);n.empty()&&(n=e.append("g").attr("class",i)),b(n);var r=n.selectAll("circle."+s).data(n.datum());r.enter().append("circle").attr("class",s).attr("r",l).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).on("mousemove",function(e){var t=d3.select(this);w(t),E(t,n)}).on("mouseout",function(e){var t=d3.select(this);S(t),x(n)}).append("title").text(a.title()),r.attr("cx",v).attr("cy",function(e,n){return m(e,n,t)}).select("title").text(a.title()),r.exit().remove()}function b(e){var t=e.select("path."+o).empty()?e.append("path").attr("class",o):e.select("path."+o);t.style("display","none").attr("stroke-dasharray","5,5");var n=e.select("path."+u).empty()?e.append("path").attr("class",u):e.select("path."+u);n.style("display","none").attr("stroke-dasharray","5,5")}function w(e){return e.style("fill-opacity",.8),e.style("stroke-opacity",.8),e}function E(e,t){var n=e.attr("cx"),r=e.attr("cy");t.select("path."+o).style("display","").attr("d","M"+a.margins().left+" "+r+"L"+n+" "+r),t.select("path."+u).style("display","").attr("d","M"+n+" "+(a.height()-a.margins().bottom)+"L"+n+" "+r)}function S(e){e.style("fill-opacity",1e-6).style("stroke-opacity",1e-6)}function x(e){e.select("path."+o).style("display","none"),e.select("path."+u).style("display","none")}var n=1,r=5,i="tooltip",s="dot",o="yRef",u="xRef",a=dc.stackableChart(dc.coordinateGridChart({})),f=!1,l=r;a.transitionDuration(500),a.plotData=function(){var e=a.allGroups();a.calculateDataPointMatrix(e);for(var t=0;t<e.length;++t){var n=e[t];c(t,n)}};var v=function(e){return a.margins().left+a.x()(a.keyAccessor()(e))},m=function(e,t,n){return a.getChartStack().getDataPoint(n,t)};return a.renderArea=function(e){return arguments.length?(f=e,a):f},a.dotRadius=function(e){return arguments.length?(l=e,a):l},a.anchor(e,t)},dc.dataCount=function(e,t){var n=d3.format(",d"),r=dc.baseChart({});return r.doRender=function(){return r.selectAll(".total-count").text(n(r.dimension().size())),r.selectAll(".filter-count").text(n(r.group().value())),r},r.doRedraw=function(){return r.doRender()},r.anchor(e,t)},dc.dataTable=function(e,t){function a(){var e=n.root().selectAll("tbody").data(f(),function(e){return n.keyAccessor()(e)}),t=e.enter().append("tbody");return t.append("tr").attr("class","group").append("td").attr("class","label").attr("colspan",i.length).text(function(e){return n.keyAccessor()(e)}),e.exit().remove(),t}function f(){u||(u=crossfilter.quicksort.by(s));var e=n.dimension().top(r);return d3.nest().key(n.group()).sortKeys(o).entries(u(e,0,e.length))}function l(e){var t=e.order().selectAll("tr.row").data(function(e){return e.values}),n=t.enter().append("tr").attr("class","row");for(var r=0;r<i.length;++r){var s=i[r];n.append("td").attr("class","column "+r).text(function(e){return s(e)})}return t.exit().remove(),t}var n=dc.baseChart({}),r=25,i=[],s=function(e){return e},o=d3.ascending,u;return n.doRender=function(){return n.selectAll("tbody").remove(),l(a()),n},n.doRedraw=function(){return n.doRender()},n.size=function(e){return arguments.length?(r=e,n):r},n.columns=function(e){return arguments.length?(i=e,n):i},n.sortBy=function(e){return arguments.length?(s=e,n):s},n.order=function(e){return arguments.length?(o=e,n):o},n.anchor(e,t)},dc.bubbleChart=function(e,t){function s(e){var t=e.enter().append("g");t.attr("class",n.BUBBLE_NODE_CLASS).attr("transform",i).append("circle").attr("class",function(e,t){return n.BUBBLE_CLASS+" _"+t}).on("click",n.onClick).attr("fill",n.initBubbleColor).attr("r",0),dc.transition(e,n.transitionDuration()).attr("r",function(e){return n.bubbleR(e)}).attr("opacity",function(e){return n.bubbleR(e)>0?1:0}),n.doRenderLabel(t),n.doRenderTitles(t)}function o(e){dc.transition(e,n.transitionDuration()).attr("transform",i).selectAll("circle."+n.BUBBLE_CLASS).attr("fill",n.updateBubbleColor).attr("r",function(e){return n.bubbleR(e)}).attr("opacity",function(e){return n.bubbleR(e)>0?1:0}),n.doUpdateLabels(e),n.doUpdateTitles(e)}function u(e){e.exit().remove()}function a(e){var t=n.x()(n.keyAccessor()(e))+n.margins().left;return isNaN(t)&&(t=0),t}function f(e){var t=n.margins().top+n.y()(n.valueAccessor()(e));return isNaN(t)&&(t=0),t}var n=dc.abstractBubbleChart(dc.coordinateGridChart({})),r=!1;n.transitionDuration(750);var i=function(e){return"translate("+a(e)+","+f(e)+")"};return n.elasticRadius=function(e){return arguments.length?(r=e,n):r},n.plotData=function(){r&&n.r().domain([n.rMin(),n.rMax()]),n.r().range([n.MIN_RADIUS,n.xAxisLength()*n.maxBubbleRelativeSize()]);var e=n.g().selectAll("g."+n.BUBBLE_NODE_CLASS).data(n.group().all());s(e),o(e),u(e),n.fadeDeselectedArea()},n.renderBrush=function(e){},n.redrawBrush=function(e){n.fadeDeselectedArea()},n.anchor(e,t)},dc.compositeChart=function(e,t){function s(e,t){e.generateG(r.g()),e.g().attr("class",n+" _"+t)}function o(){var e=[];for(var t=0;t<i.length;++t)e.push(i[t].yAxisMin());return e}function u(){var e=[];for(var t=0;t<i.length;++t)e.push(i[t].yAxisMax());return e}function a(){var e=[];for(var t=0;t<i.length;++t)e.push(i[t].xAxisMin());return e}function f(){var e=[];for(var t=0;t<i.length;++t)e.push(i[t].xAxisMax());return e}var n="sub",r=dc.coordinateGridChart({}),i=[];return r.transitionDuration(500),dc.override(r,"generateG",function(e){var t=e();for(var n=0;n<i.length;++n){var o=i[n];s(o,n),o.dimension()==null&&o.dimension(r.dimension()),o.group()==null&&o.group(r.group()),o.chartGroup(r.chartGroup()),o.svg(r.svg()),o.height(r.height()),o.width(r.width()),o.margins(r.margins()),o.xUnits(r.xUnits()),o.transitionDuration(r.transitionDuration())}return t}),r.plotData=function(){for(var e=0;e<i.length;++e){var t=i[e];t.g()==null&&s(t,e),t.x(r.x()),
t.y(r.y()),t.xAxis(r.xAxis()),t.yAxis(r.yAxis()),t.plotData(),t.invokeRenderlet(t)}},r.fadeDeselectedArea=function(){for(var e=0;e<i.length;++e){var t=i[e];t.brush(r.brush()),t.fadeDeselectedArea()}},r.compose=function(e){return i=e,r},r.children=function(){return i},r.yAxisMin=function(){return d3.min(o())},r.yAxisMax=function(){return dc.utils.add(d3.max(u()),r.yAxisPadding())},r.xAxisMin=function(){return dc.utils.subtract(d3.min(a()),r.xAxisPadding())},r.xAxisMax=function(){return dc.utils.add(d3.max(f()),r.xAxisPadding())},r.anchor(e,t)},dc.geoChoroplethChart=function(e,t){function s(e){var t=dc.utils.groupMax(n.group(),n.valueAccessor()),r=o();if(u(e)){var i=a(e);d(i,e,r,t),m(i,e,r)}}function o(){var e={},t=n.group().all();for(var r=0;r<t.length;++r)e[n.keyAccessor()(t[r])]=n.valueAccessor()(t[r]);return e}function u(e){return p(e).keyAccessor}function a(e){var t=n.svg().selectAll(f(e)).classed("selected",function(t){return l(e,t)}).classed("deselected",function(t){return c(e,t)}).attr("class",function(t){var n=p(e).name,r=dc.utils.nameToId(p(e).keyAccessor(t)),i=n+" "+r;return l(e,t)&&(i+=" selected"),c(e,t)&&(i+=" deselected"),i});return t}function f(e){return"g.layer"+e+" g."+p(e).name}function l(e,t){return n.hasFilter()&&n.filter()==h(e,t)}function c(e,t){return n.hasFilter()&&n.filter()!=h(e,t)}function h(e,t){return p(e).keyAccessor(t)}function p(e){return i[e]}function d(e,t,r,i){var s=e.select("path").attr("fill",function(e){var t=d3.select(this).attr("fill");return t?t:"none"}).on("click",function(e){return v(e,t)});dc.transition(s,n.transitionDuration()).attr("fill",function(e,i){return n.getColor(r[p(t).keyAccessor(e)],i)})}function v(e,t){var r=p(t).keyAccessor(e);r==n.filter()?dc.events.trigger(function(){n.filter(null),dc.redrawAll(n.chartGroup())}):dc.events.trigger(function(){n.filter(r),dc.redrawAll(n.chartGroup())})}function m(e,t,r){n.renderTitle()&&e.selectAll("title").text(function(e){var i=h(t,e),s=r[i];return n.title()({key:i,value:s})})}var n=dc.singleSelectionChart(dc.colorChart(dc.baseChart({})));n.colorAccessor(function(e,t){return e});var r=d3.geo.path(),i=[];return n.doRender=function(){n.resetSvg();for(var e=0;e<i.length;++e){var t=n.svg().append("g").attr("class","layer"+e),o=t.selectAll("g."+p(e).name).data(p(e).data).enter().append("g").attr("class",p(e).name);o.append("path").attr("fill","white").attr("d",r),o.append("title"),s(e)}},n.doRedraw=function(){for(var e=0;e<i.length;++e)s(e)},n.overlayGeoJson=function(e,t,r){return i.push({name:t,data:e,keyAccessor:r}),n},n.projection=function(e){return r.projection(e),n},n.anchor(e,t)},dc.bubbleOverlay=function(e,t){function a(){return o=s.select("g."+n),o.empty()&&(o=s.svg().append("g").attr("class",n)),o}function f(){var e=l();u.forEach(function(t){var n=c(t,e),r=n.select("circle."+i);r.empty()&&(r=n.append("circle").attr("class",i).attr("r",0).attr("fill",s.initBubbleColor).on("click",s.onClick)),dc.transition(r,s.transitionDuration()).attr("r",function(e){return s.bubbleR(e)}),s.doRenderLabel(n),s.doRenderTitles(n)})}function l(){var e={};return s.group().all().forEach(function(t){e[s.keyAccessor()(t)]=t}),e}function c(e,t){var n=r+" "+dc.utils.nameToId(e.name),i=o.select("g."+dc.utils.nameToId(e.name));return i.empty()&&(i=o.append("g").attr("class",n).attr("transform","translate("+e.x+","+e.y+")")),i.datum(t[e.name]),i}function h(){var e=l();u.forEach(function(t){var n=c(t,e),r=n.select("circle."+i);dc.transition(r,s.transitionDuration()).attr("r",function(e){return s.bubbleR(e)}).attr("fill",s.updateBubbleColor),s.doUpdateLabels(n),s.doUpdateTitles(n)})}var n="bubble-overlay",r="node",i="bubble",s=dc.abstractBubbleChart(dc.baseChart({})),o,u=[];return s.transitionDuration(750),s.radiusValueAccessor(function(e){return e.value}),s.point=function(e,t,n){return u.push({name:e,x:t,y:n}),s},s.doRender=function(){return o=a(),s.r().range([s.MIN_RADIUS,s.width()*s.maxBubbleRelativeSize()]),f(),s.fadeDeselectedArea(),s},s.doRedraw=function(){return h(),s.fadeDeselectedArea(),s},s.debug=function(e){if(e){var t=s.select("g."+dc.constants.DEBUG_GROUP_CLASS);t.empty()&&(t=s.svg().append("g").attr("class",dc.constants.DEBUG_GROUP_CLASS));var n=t.append("text").attr("x",10).attr("y",20);t.append("rect").attr("width",s.width()).attr("height",s.height()).on("mousemove",function(){var e=d3.mouse(t.node()),r=e[0]+", "+e[1];n.text(r)})}else s.selectAll(".debug").remove();return s},s.anchor(e,t),s};